Mimicking what happens in TensorFlow